<!DOCTYPE html>
<html>
<!-- ======================================================================= -->
<!-- =                                                                     = -->
<!-- ======================================================================= -->
<head>
    <meta charset="UTF-8">
    <title>Phone bill</title>
</head>

<!-- ======================================================================= -->
<!-- =                                                                     = -->
<!-- ======================================================================= -->
<body>

<div>
    <p>Phone bill test.  <b>See console for output</b>.</p>
</div>


<script>
    ////////////////////////////////////////////////////////////////////////////
    //  Q2. 45 mins
    //  You received a phone bill which is larger than you think so you write a
    //  function to calculate what your bill would be.
    //
    //  The function should return (in cents) the value of your bill.
    //
    //  For every call under 5 minutes it is 3 cents per second.
    //
    //  For every call over 5 minutes it should be the rounded up minute * 150
    //  cents.
    //  So exactly 5 mins would be 750c, 5 mins and one second would be 6 * 150
    //  = 900.
    //
    //  As a promotion the phone number on your bill with the longest duration
    //  of calls would be free.

    //  If two different numbers have the same cost then the value that is free
    //  is the lowest phone number (i.e. 0191555555 is the free one as it beats
    //  01917777777).
    //
    //  Input to function is a single string.
    //  Each line is separated by a new line character (ascii 10).
    //
    //  Format "HH:MM:SS:nnn-nnn-nnn " and is fixed length (lengths won't
    //  change). HH â€“ hours, MM mins, SS seconds, nnn-nnn-nnn is the phone
    //  number.
    //
    //  Return an integer  with the cost in cents of the phone bill.
    //
    //  Test data might be
    //    "00:05:01:333-444-555\n00:05:00:123-456-789\n00:05:01:333-444-555"
    //
    //  which would return 750 as the 333-444-555 calls are longest duration and
    //  thus free.
    ////////////////////////////////////////////////////////////////////////////
    function test(input) {
        var records = input.split("\n");
        var calls = [];
        var totalCost = 0;


        // Go through each record and use the data to create a 'call' object for each record
        for(var index = 0; index < records.length; ++index) {
            var duration = records[index].substring(0, 8);
            var number = records[index].substring(9);
            var cost = getCost(duration);

            // Create an object containing all detais including cost of call and
            // add it to a collection of call objects
            calls[index] = {"Number": number, "duration": duration, "Cost": cost};

        } // End for all records

        // Calculate the total cost of all calls
        for(index = 0; index < calls.length; ++index) {

            totalCost += calls[index].Cost;
        }

        // Return the total cost less the promotional 'longest call cost'.
        return totalCost - getTopDurationCost(calls);

        ////////////////////////////////////////////////////////////////////////
        // Get cost of the longest call
        ////////////////////////////////////////////////////////////////////////
        function getTopDurationCost(calls) {
            var longestTime = 0;
            var returnCost = 0;

            for(var index = 0; index < calls.length; ++index) {
                var time = calls[index].duration.split(':');
                var hours = parseInt(time[0], 10);
                var minutes = parseInt(time[1], 10);
                var seconds = parseInt(time[2], 10);

                var totalSeconds = seconds + (minutes * 60) + (hours * 3600);

                if(totalSeconds > longestTime) {
                    longestTime = totalSeconds;

                    returnCost = calls[index].Cost;
                }
            }

            return returnCost;
        }

        ////////////////////////////////////////////////////////////////////////
        // Calculate a call cost based on duration
        ////////////////////////////////////////////////////////////////////////
        function getCost(duration) {

            var cost =  0;
            var time = duration.split(':');
            var hours = parseInt(time[0], 10);
            var minutes = parseInt(time[1], 10);
            var seconds = parseInt(time[2], 10);

            // Get total duration of call in seconds
            var totalSeconds = seconds + (minutes * 60) + (hours * 3600);

            // Determine if we need to round up based on call length (5 mins and
            // above are rounded to the next full minute)
            var roundedMinutes = minutes;

            
            // BUG BUG BUG - WHAT IF HOURS WERE 1 AND MINUTES ONLY 3?
            // BUG BUG BUG - WHAT IF HOURS WERE 1 AND MINUTES ONLY 3?
            // BUG BUG BUG - WHAT IF HOURS WERE 1 AND MINUTES ONLY 3?
            // BUG BUG BUG - WHAT IF HOURS WERE 1 AND MINUTES ONLY 3?
            // BUG BUG BUG - WHAT IF HOURS WERE 1 AND MINUTES ONLY 3?
            // BUG BUG BUG - WHAT IF HOURS WERE 1 AND MINUTES ONLY 3?
            // BUG BUG BUG - WHAT IF HOURS WERE 1 AND MINUTES ONLY 3?
            // BUG BUG BUG - WHAT IF HOURS WERE 1 AND MINUTES ONLY 3?
            if((minutes >= 5) && (seconds > 0)) {
                roundedMinutes = minutes + 1;
            }

            // If the call was less than 5 minutes, then we bill 3 cents per second
            if(roundedMinutes < 5) {
                cost = totalSeconds * 3; // 3 cents per second
            }

            // Else it's 150 cents per rounded minute
            else {
                cost = roundedMinutes * 150; // 150 cents per minute
            }

            return cost;
        }
    }

    ////////////////////////////////////////////////////////////////////////////
    // Run some tests
    ////////////////////////////////////////////////////////////////////////////
    console.log("'01:04:01:333-444-555\\n01:05:00:123-456-789\\n01:05:01:333-444-555': Should return 19500, Returns: " + test("01:04:01:333-444-555\n01:05:00:123-456-789\n01:05:01:333-444-555"));
    console.log("'00:04:01:333-444-555\\n00:05:00:123-456-789\\n00:05:01:333-444-555': Should return 1473, Returns: " + test("00:04:01:333-444-555\n00:05:00:123-456-789\n00:05:01:333-444-555"));
    console.log("'00:03:21:333-444-555\\n00:06:00:123-456-789\\n00:05:01:333-444-555': Should return 1503, Returns: " + test("00:03:21:333-444-555\n00:06:00:123-456-789\n00:05:01:333-444-555"));
    console.log("'00:03:21:333-444-555': Should return 0, Returns: " + test("00:03:21:333-444-555"));
    console.log("'23:59:59:333-444-555\\n23:59:59:333-444-555': Should return 216000, Returns: " + test("23:59:59:333-444-555\n23:59:59:333-444-555"));
    console.log("'00:03:34:01912272838\\n23:59:59:333-444-555': Should return 642, Returns: " + test("00:03:34:01912272838\n23:59:59:333-444-555"));
    console.log("00:05:01:111-111-111-111\\n00:05:00:222-222-222-222\\n01:02:10:333-333-333-333\\n00:02:25:444-444-444-444\\n00:11:22:111-111-111-111 returns: " + test("00:05:01:111-111-111-111\n00:05:00:222-222-222-222\n01:02:10:333-333-333-333\n00:02:25:444-444-444-444\n00:11:22:111-111-111-111"));
    console.log("00:05:01:111-111-111-111\\n00:05:00:222-222-222-222\\n00:02:10:333-333-333-333\\n00:02:25:444-444-444-444\\n00:11:22:111-111-111-111 returns: " + test("00:05:01:111-111-111-111\n00:05:00:222-222-222-222\n00:02:10:333-333-333-333\n00:02:25:444-444-444-444\n00:11:22:111-111-111-111"));
    console.log("00:05:01:111-111-111-111\\n00:45:00:222-222-222-222\\n00:02:10:333-333-333-333\\n00:02:25:444-444-444-444\\n00:11:22:111-111-111-111 returns: " + test("00:05:01:111-111-111-111\n00:45:00:222-222-222-222\n00:02:10:333-333-333-333\n00:02:25:444-444-444-444\n00:11:22:111-111-111-111"));
    console.log("00:05:01:222-111-111-111\\n00:05:00:333-111-111-111\\n00:04:22:111-111-111-111\\n00:05:00:444-111-111-111\\n00:05:00:999-111-111-111 returns: " + test("00:05:01:222-111-111-111\n00:05:00:333-111-111-111\n00:04:22:111-111-111-111\n00:05:00:444-111-111-111\n00:05:00:999-111-111-111"));


</script>



</body>

</html>